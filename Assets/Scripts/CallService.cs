using System.Collections;
using System.Collections.Generic;
using System.Text;
using Mapbox.Json;
using UnityEngine;
using UnityEngine.Networking;
using UnityEngine.SceneManagement;

public class CallService : MonoBehaviour
{
    [System.Serializable]
    public struct localizacion
    {
        public float lat;
        public float lng;
    }

    [System.Serializable]
    public struct estructuraDatos
    {
        public int totalDays;
        public localizacion location;
        public string startDate;
        public string[] categories;
    }

    public static CallService Instance { set; get; }

    public estructuraDatos datos;
    Tour toursDays = new Tour();
    PointOfInterest poi;
    Schedule[] schedule;
    List<PointOfInterest>[] days;
    public bool flag;
    private Variables variables;

    private void Awake()
    {
        Instance = this;
    }

    void Start()
    {
        //StartCoroutine(PostData_Coroutine());
        //GameObject.Find("ButtonSubmit").GetComponent<Button>().onClick.AddListener(PostData_Coroutine);
        PostData_Coroutine();
    }

    //void PostData() => StartCoroutine(PostData_Coroutine());
    //IEnumerator PostData_Coroutine()
    
    void PostData_Coroutine()
    {

        var request = new UnityWebRequest("http://localhost:8080/ttdp", "POST");
        string json = JsonUtility.ToJson(datos);

        byte[] bodyRaw = Encoding.UTF8.GetBytes(json);
        request.uploadHandler = (UploadHandler)new UploadHandlerRaw(bodyRaw);
        request.downloadHandler = (DownloadHandler)new DownloadHandlerBuffer();
        request.SetRequestHeader("Content-Type", "application/json");
        string respuesta = "[{\"tour\":[{\"type\":\"home\",\"location\":{\"lat\":-0.12914758920669556,\"lng\":-78.48616790771484}},{\"type\":\"route\",\"duration\":65.85,\"points\":\"`fXrj`~MgAEQvAWxBDFBJCLIHEBQdASjBKl@IT_@l@UPc@R_@HaCT{@Na@Rg@b@_@x@Mp@?n@TxAVdAL\\\\n@x@X\\\\|Ea@P@NDLJJRHVj@lC^rBXfBzB@nCHzBBxCF|CItESjEKlCMbCUf@bDXfBhBpLpAbJRhAP@f@lCl@~DFb@BJFFJJx@EfEW`F[xC_@PEH\\\\fDtInBhFTx@z@bFNx@RbAn@fCNr@@RGfAQ|CE\\\\dCWvIcAxAY|AQlAO\",\"schedule\":{\"start\":\"07:54\",\"end\":\"09:00\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"Antonio Costas, Quito 170132, Ecuador\",\"formatted_phone_number\":\"(02) 380-3043\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/museum-71.png\",\"international_phone_number\":\"+593 2-380-3043\",\"name\":\"Florida Museum Site\",\"opening_hours\":{\"open_now\":false,\"periods\":[{\"open\":\"0900\",\"close\":\"1630\"},null,null,{\"open\":\"0900\",\"close\":\"1630\"},{\"open\":\"0900\",\"close\":\"1630\"},{\"open\":\"0900\",\"close\":\"1630\"},{\"open\":\"0900\",\"close\":\"1630\"}],\"weekday_text\":[\"Monday: Closed\",\"Tuesday: Closed\",\"Wednesday: 9:00 AM – 4:30 PM\",\"Thursday: 9:00 AM – 4:30 PM\",\"Friday: 9:00 AM – 4:30 PM\",\"Saturday: 9:00 AM – 4:30 PM\",\"Sunday: 9:00 AM – 4:30 PM\"]},\"place_id\":\"ChIJzTFyPc2a1ZERluzvPXAZJis\",\"plus_code\":{\"compound_code\":\"VF3V+63 Quito, Ecuador\",\"global_code\":\"67F3VF3V+63\"},\"rating\":4.6,\"url\":\"https://maps.google.com/?cid=3109200562612071574\",\"user_ratings_total\":278,\"utc_offset\":-300,\"vicinity\":\"Antonio Costas, Quito\",\"website\":\"http://www.patrimonio.quito.gob.ec/index.php/servicios-ciudadanos/sitios-arqueologicos/32-la-florida\",\"location\":{\"lat\":-0.1469332,\"lng\":-78.5073563},\"expected_time\":43,\"schedule\":{\"start\":\"09:00\",\"end\":\"09:43\"}},{\"type\":\"route\",\"duration\":35.43333333333333,\"points\":\"nu[xnd~MuDb@yAXgDb@uHv@NeCNkBA]Mu@i@wBSy@SeAeAmGmAeD{C{H}@aCI]eAPmANaBJmCRwCPcBHO@IIGECGGg@_@_Ce@kCa@oCuAiJeC}Oe@_DXEK_A]_Cw@Jk@ByANsBXiAPu@H\",\"schedule\":{\"start\":\"09:43\",\"end\":\"10:18\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"De la Prensa Y Fernandez Salvador, Quito 170104, Ecuador\",\"formatted_phone_number\":\"(02) 244-5034\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/museum-71.png\",\"international_phone_number\":\"+593 2-244-5034\",\"name\":\"Museo Aeronáutico y del Espacio\",\"opening_hours\":{\"open_now\":false,\"periods\":[null,null,{\"open\":\"0900\",\"close\":\"1600\"},{\"open\":\"0800\",\"close\":\"1600\"},{\"open\":\"0900\",\"close\":\"1600\"},{\"open\":\"0800\",\"close\":\"1500\"},{\"open\":\"0800\",\"close\":\"1500\"}],\"weekday_text\":[\"Monday: Closed\",\"Tuesday: 9:00 AM – 4:00 PM\",\"Wednesday: 8:00 AM – 4:00 PM\",\"Thursday: 9:00 AM – 4:00 PM\",\"Friday: 8:00 AM – 3:00 PM\",\"Saturday: 8:00 AM – 3:00 PM\",\"Sunday: Closed\"]},\"place_id\":\"ChIJm3VVnPSF1ZERKH6SCa_HXY8\",\"plus_code\":{\"compound_code\":\"VG84+HP Quito, Ecuador\",\"global_code\":\"67F3VG84+HP\"},\"rating\":4.2,\"url\":\"https://maps.google.com/?cid=10330632674851585576\",\"user_ratings_total\":18,\"utc_offset\":-300,\"vicinity\":\"De la Prensa Y Fernandez Salvador, Quito\",\"location\":{\"lat\":-0.1335226,\"lng\":-78.4931362},\"expected_time\":79,\"schedule\":{\"start\":\"10:18\",\"end\":\"11:37\"}},{\"type\":\"route\",\"duration\":51.31666666666667,\"points\":\"`bWhl}}MPIHEv@~BdAFj@DdA?`AKfBWpEo@FC`Eg@~CQb@C@Td@hHb@jHf@tD`@hDNtA@ZsBn@B^?XKrFE`EEvDInDdCPIrB]zHStFEt@O~Am@fF]vCCZ@@@@BJAHKNGBk@rEGTQ^a@d@ULc@Na@FqCZe@Ja@VSPa@p@M`@GXAj@`@jCRn@PX~@jAjFa@Bg@|AM|RoBdJy@MNEFMRCXBt@H|@Tj@t@rAHV\\\\|B_AN\",\"schedule\":{\"start\":\"11:37\",\"end\":\"12:28\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"Francisco de la Torre, Quito, Ecuador\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/park-71.png\",\"name\":\"Parque\",\"place_id\":\"ChIJJZAVYYmP1ZERSJA_ZLTeLO4\",\"plus_code\":{\"compound_code\":\"VGGH+MG Quito, Ecuador\",\"global_code\":\"67F3VGGH+MG\"},\"rating\":5,\"url\":\"https://maps.google.com/?cid=17162337146359484488\",\"user_ratings_total\":1,\"utc_offset\":-300,\"vicinity\":\"Francisco de la Torre, Quito\",\"location\":{\"lat\":-0.1233446,\"lng\":-78.471184},\"expected_time\":39,\"schedule\":{\"start\":\"12:28\",\"end\":\"13:07\"}},{\"type\":\"lunch\",\"duration\":60,\"schedule\":{\"start\":\"13:07\",\"end\":\"14:07\"}},{\"type\":\"route\",\"duration\":12.916666666666666,\"points\":\"`bWhl}}MPIHEv@~BdAFj@DdA?`AKfBWpEo@FCDVhBW|CYjCMnESjBGNfAR~AjBW`AK\",\"schedule\":{\"start\":\"14:07\",\"end\":\"14:20\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"Calle E10A, California Alta, Quito 170124, Ecuador\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/park-71.png\",\"name\":\"Recreacion Park\",\"place_id\":\"ChIJKb08SfSP1ZERISDa-CdnlxA\",\"plus_code\":{\"compound_code\":\"VG9H+F7 Quito, Ecuador\",\"global_code\":\"67F3VG9H+F7\"},\"rating\":5,\"url\":\"https://maps.google.com/?cid=1195537647466586145\",\"user_ratings_total\":1,\"utc_offset\":-300,\"vicinity\":\"Calle E10A, California Alta, Quito\",\"location\":{\"lat\":-0.1313493,\"lng\":-78.4718693},\"expected_time\":35,\"schedule\":{\"start\":\"14:20\",\"end\":\"14:55\"}},{\"type\":\"route\",\"duration\":25.116666666666667,\"points\":\"xsXno}}MlCYR~AjAGxH_AjBUtIy@l@fFf@dE`DWnA?z@FvFx@J@J\\\\ZtC|C^nBXlCXrDd@zEh@bCX~Cb@nBXnBP~Gz@RD\",\"schedule\":{\"start\":\"14:55\",\"end\":\"15:20\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"Calle N80c, S/N, Quito 170184, Ecuador\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/park-71.png\",\"name\":\"Publico Park\",\"place_id\":\"ChIJz8l_6qqa1ZERKXHRIyXyE70\",\"plus_code\":{\"compound_code\":\"VG2F+W7 Quito, Ecuador\",\"global_code\":\"67F3VG2F+W7\"},\"rating\":4.4,\"url\":\"https://maps.google.com/?cid=13624499539054522665\",\"user_ratings_total\":8,\"utc_offset\":-300,\"vicinity\":\"Calle N80c, S/N, Quito\",\"location\":{\"lat\":-0.1476396,\"lng\":-78.47679819999999},\"expected_time\":66,\"schedule\":{\"start\":\"15:20\",\"end\":\"16:26\"}},{\"type\":\"route\",\"duration\":0,\"points\":\"t{[`o~}M\",\"schedule\":{\"start\":\"16:26\",\"end\":\"16:26\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"Calle N80c S/N, Quito 170138, Ecuador\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/park-71.png\",\"name\":\"Publico Park\",\"place_id\":\"ChIJRU958qqa1ZEROc_KX0NFQAQ\",\"plus_code\":{\"compound_code\":\"VG2F+P7 Quito, Ecuador\",\"global_code\":\"67F3VG2F+P7\"},\"rating\":4.1,\"url\":\"https://maps.google.com/?cid=306320930333445945\",\"user_ratings_total\":7,\"utc_offset\":-300,\"vicinity\":\"Calle N80c S/N, Quito\",\"location\":{\"lat\":-0.1482203,\"lng\":-78.47681759999999},\"expected_time\":66,\"schedule\":{\"start\":\"16:26\",\"end\":\"17:32\"}},{\"type\":\"route\",\"duration\":11.566666666666666,\"points\":\"~i[xm_~MzCi@[eBhCg@tAWoAmHw@kE`Dk@r@OPCSgAdCE@iB@U\",\"schedule\":{\"start\":\"17:32\",\"end\":\"17:44\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"Francisco Salgado 616, Quito 170138, Ecuador\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/museum-71.png\",\"name\":\"La casa salgado\",\"place_id\":\"ChIJfTIQFZ2F1ZERaXpZIE6G4Nw\",\"plus_code\":{\"compound_code\":\"VG39+X9 Quito, Ecuador\",\"global_code\":\"67F3VG39+X9\"},\"rating\":5,\"url\":\"https://maps.google.com/?cid=15915868753235638889\",\"user_ratings_total\":1,\"utc_offset\":-300,\"vicinity\":\"Francisco Salgado 616, Quito\",\"location\":{\"lat\":-0.1450814,\"lng\":-78.4815998},\"expected_time\":54,\"schedule\":{\"start\":\"17:44\",\"end\":\"18:30\"}}],\"restaurants\":[{\"business_status\":\"OPERATIONAL\",\"geometry\":{\"viewport\":{\"northeast\":{\"lat\":-0.1254381701072778,\"lng\":-78.46765482010727},\"southwest\":{\"lat\":-0.1281378298927222,\"lng\":-78.47035447989272}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/restaurant-71.png\",\"name\":\"A Tu Gusto\",\"opening_hours\":{\"open_now\":false},\"place_id\":\"ChIJGUoNmYyP1ZERD-3cn-YQt1c\",\"plus_code\":{\"compound_code\":\"VGFJ+79 Quito\",\"global_code\":\"67F3VGFJ+79\"},\"rating\":4.7,\"reference\":\"ChIJGUoNmYyP1ZERD-3cn-YQt1c\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":3,\"vicinity\":\"Av Jorge Garces N60-87, Quito\",\"location\":{\"lat\":-0.1267802,\"lng\":-78.4690174},\"schedule\":{\"start\":\"13:07\",\"end\":\"14:07\"}},{\"business_status\":\"OPERATIONAL\",\"geometry\":{\"viewport\":{\"northeast\":{\"lat\":-0.1254357701072778,\"lng\":-78.46706797010728},\"southwest\":{\"lat\":-0.1281354298927222,\"lng\":-78.46976762989271}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/restaurant-71.png\",\"name\":\"Platos Típicos\",\"place_id\":\"ChIJyfGhBOqP1ZER7_Ci2NFpHEs\",\"plus_code\":{\"compound_code\":\"VGFJ+7J Quito\",\"global_code\":\"67F3VGFJ+7J\"},\"rating\":4,\"reference\":\"ChIJyfGhBOqP1ZER7_Ci2NFpHEs\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":3,\"vicinity\":\"Jorge Garces Y, Vitores 2, Quito\",\"location\":{\"lat\":-0.1267856,\"lng\":-78.4684178},\"schedule\":{\"start\":\"13:07\",\"end\":\"14:07\"}},{\"business_status\":\"OPERATIONAL\",\"geometry\":{\"viewport\":{\"northeast\":{\"lat\":-0.1240386201072778,\"lng\":-78.46889622010727},\"southwest\":{\"lat\":-0.1267382798927222,\"lng\":-78.47159587989272}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/restaurant-71.png\",\"name\":\"Las Papicanastas Urbanas\",\"opening_hours\":{\"open_now\":false},\"photos\":[{\"height\":3376,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/115638065982432409999\\\">Marco THE Kdos</a>\"],\"photo_reference\":\"Aap_uECR6sDshDssSj0ziUQnJ08H-YBMVCi86c_sqVUFMVntVkyzd6bXpvPC5vHLGRkj8-lHLKYPT8XnxFlYEkn80oQ6hRjqbqDCiDndQgfLGuYljOS0ajeN5m0XaHV1qD3bvavivFjGGPJHxmCFQxhgImgAY_kR4y_EaqdiNv2s9oMI2nP4\",\"width\":5984}],\"place_id\":\"ChIJ8eLZsIKP1ZERwni9kI_bcZo\",\"plus_code\":{\"compound_code\":\"VGFH+RV Quito\",\"global_code\":\"67F3VGFH+RV\"},\"rating\":0,\"reference\":\"ChIJ8eLZsIKP1ZERwni9kI_bcZo\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":0,\"vicinity\":\"Francisco de la Torre Y, Juan de León 2, Quito\",\"location\":{\"lat\":-0.1254757,\"lng\":-78.47029479999999},\"schedule\":{\"start\":\"13:07\",\"end\":\"14:07\"}},{\"business_status\":\"OPERATIONAL\",\"geometry\":{\"viewport\":{\"northeast\":{\"lat\":-0.1212826701072778,\"lng\":-78.46960997010729},\"southwest\":{\"lat\":-0.1239823298927222,\"lng\":-78.47230962989272}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/restaurant-71.png\",\"name\":\"Encebollados Mery\",\"opening_hours\":{\"open_now\":false},\"photos\":[{\"height\":627,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/101067367568286801462\\\">Danfred Dan</a>\"],\"photo_reference\":\"Aap_uEBRuwdbuOAeVArsLiw_9ltj5zs_xku8iQTlWV8WorKqBwUYzbcXaGbw8sCRFl7wC-CsPN1N07ij2MrnHgb7jWJvxnL9rYDqJL2r61tjn95mgkWh6UgNvYWHANmU7-hR7kjgbxdIt5J0NW6yJyeswvIQf3R1_QIBjnWTe8ITp7IVSl5F\",\"width\":940}],\"place_id\":\"ChIJ5dsp236P1ZERe65wQyuOo6c\",\"plus_code\":{\"compound_code\":\"VGGH+WJ Quito\",\"global_code\":\"67F3VGGH+WJ\"},\"rating\":4.5,\"reference\":\"ChIJ5dsp236P1ZERe65wQyuOo6c\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":2,\"vicinity\":\"Avenida Francisco de la Torre, Quito\",\"location\":{\"lat\":-0.1226298,\"lng\":-78.4709661},\"schedule\":{\"start\":\"13:07\",\"end\":\"14:07\"}},{\"business_status\":\"OPERATIONAL\",\"geometry\":{\"viewport\":{\"northeast\":{\"lat\":-0.1246066201072778,\"lng\":-78.46882597010729},\"southwest\":{\"lat\":-0.1273062798927222,\"lng\":-78.47152562989272}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/restaurant-71.png\",\"name\":\"La Gran Pezca\",\"photos\":[{\"height\":2048,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/100988671787310151873\\\">Christian Valdivieso</a>\"],\"photo_reference\":\"Aap_uEB-7ifT9UpEm9LBH-gIN3nGL7OQZ8Zm2UKB8VQj55bjYRDxDl5MSu5HWpMa8zmGkLlgFLT77B7HnqijZX0g0fH4CFMYFPffabtzz5bZf0StdIFXL635FHq6jyal9F35lqA40FwEPQ6-YBzOBBm3EHcFU_Ai5dDPGJjaVXV1AQYRfXJN\",\"width\":1536}],\"place_id\":\"ChIJ9_UpeIuP1ZEROiX7DfMUSvc\",\"plus_code\":{\"compound_code\":\"VGFH+JW Quito\",\"global_code\":\"67F3VGFH+JW\"},\"rating\":4.5,\"reference\":\"ChIJ9_UpeIuP1ZEROiX7DfMUSvc\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":11,\"vicinity\":\"Quito\",\"location\":{\"lat\":-0.1259739,\"lng\":-78.4702171},\"schedule\":{\"start\":\"13:07\",\"end\":\"14:07\"}}]},{\"tour\":[{\"type\":\"home\",\"location\":{\"lat\":-0.12914758920669556,\"lng\":-78.48616790771484}},{\"type\":\"route\",\"duration\":24.25,\"points\":\"`fXrj`~MgAEQvAWxBDFBJCLIHEBQdASjBKl@IT_@l@UPc@R_@HaCT{@Na@Rg@b@_@x@Mp@?n@TxAVdAL\\\\n@x@X\\\\|Ea@P@NDLJJRHVj@lC^rBXfBzB@Cd@@h@Dn@DnAIbBd@Dj@@f@EdBKzAE`AMbBKhAGzAOP~APC\",\"schedule\":{\"start\":\"08:35\",\"end\":\"09:00\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"San Pedro Claver, Quito 170104, Ecuador\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/park-71.png\",\"name\":\"Parque\",\"place_id\":\"ChIJmYgGCk6F1ZERS4OKh2ybLVA\",\"plus_code\":{\"compound_code\":\"VG83+VP Quito, Ecuador\",\"global_code\":\"67F3VG83+VP\"},\"rating\":4.9,\"url\":\"https://maps.google.com/?cid=5777444787418989387\",\"user_ratings_total\":11,\"utc_offset\":-300,\"vicinity\":\"San Pedro Claver, Quito\",\"location\":{\"lat\":-0.1328494,\"lng\":-78.4957263},\"expected_time\":81,\"schedule\":{\"start\":\"09:00\",\"end\":\"10:21\"}},{\"type\":\"route\",\"duration\":5.8,\"points\":\"nnXbqb~Ml@GEkAK}AzAKhFa@bBGI_BKkAPCRA\",\"schedule\":{\"start\":\"10:21\",\"end\":\"10:26\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"Mariano Godoy Oe5-245, Quito 170103, Ecuador\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/park-71.png\",\"name\":\"S Park\",\"place_id\":\"ChIJ44V8Y2yF1ZERCy52gJVFyAY\",\"plus_code\":{\"compound_code\":\"VG93+R2 Quito, Ecuador\",\"global_code\":\"67F3VG93+R2\"},\"rating\":5,\"url\":\"https://maps.google.com/?cid=488717067977371147\",\"user_ratings_total\":1,\"utc_offset\":-300,\"vicinity\":\"Mariano Godoy Oe5-245, Quito\",\"location\":{\"lat\":-0.1304545,\"lng\":-78.4974637},\"expected_time\":79,\"schedule\":{\"start\":\"10:26\",\"end\":\"11:45\"}},{\"type\":\"route\",\"duration\":24.633333333333333,\"points\":\"nnXbqb~M}@FP|AqAJcOx@cF\\\\iBFyEFuDB}CFWDw@ZCBIDQ?OCF`AoCFK?H`@cBRuEd@BvH_BAkBDaFL[HaAj@sA`A}@wA\",\"schedule\":{\"start\":\"11:45\",\"end\":\"12:10\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"Thomas, Quito 170103, Ecuador\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/park-71.png\",\"name\":\"ciudadela Thomas Park\",\"opening_hours\":{\"open_now\":false,\"periods\":[{\"open\":\"0800\",\"close\":\"2000\"},{\"open\":\"0800\",\"close\":\"2000\"},{\"open\":\"0800\",\"close\":\"2000\"},{\"open\":\"0800\",\"close\":\"2000\"},{\"open\":\"0800\",\"close\":\"2000\"},{\"open\":\"0800\",\"close\":\"2000\"},{\"open\":\"0800\",\"close\":\"2000\"}],\"weekday_text\":[\"Monday: 8:00 AM – 8:00 PM\",\"Tuesday: 8:00 AM – 8:00 PM\",\"Wednesday: 8:00 AM – 8:00 PM\",\"Thursday: 8:00 AM – 8:00 PM\",\"Friday: 8:00 AM – 8:00 PM\",\"Saturday: 8:00 AM – 8:00 PM\",\"Sunday: 8:00 AM – 8:00 PM\"]},\"place_id\":\"ChIJne1frQ2F1ZERgH3LAqL3wfY\",\"plus_code\":{\"compound_code\":\"VFMX+7C Quito, Ecuador\",\"global_code\":\"67F3VFMX+7C\"},\"rating\":3.8,\"url\":\"https://maps.google.com/?cid=17780765079039081856\",\"user_ratings_total\":71,\"utc_offset\":-300,\"vicinity\":\"Thomas, Quito\",\"location\":{\"lat\":-0.1167625,\"lng\":-78.5014729},\"expected_time\":50,\"schedule\":{\"start\":\"12:10\",\"end\":\"13:00\"}},{\"type\":\"lunch\",\"duration\":60,\"schedule\":{\"start\":\"13:00\",\"end\":\"14:00\"}},{\"type\":\"route\",\"duration\":18.133333333333333,\"points\":\"rwU~ic~MsAwBqAt@eA_BMLw@mAw@oAy@`@c@LUBqENwABe@Ao@FgBPe@?g@GKj@?XiGf@mCb@cBNi@Hu@XWN]TXb@r@~@~@bARRZPz@VpATTsA\",\"schedule\":{\"start\":\"14:00\",\"end\":\"14:18\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"Pasaje Y, Quito 170301, Ecuador\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/park-71.png\",\"name\":\"Parque\",\"place_id\":\"ChIJca-YoaCF1ZER2xdjS1EBmSo\",\"plus_code\":{\"compound_code\":\"VFRX+53 Quito, Ecuador\",\"global_code\":\"67F3VFRX+53\"},\"rating\":3.7,\"url\":\"https://maps.google.com/?cid=3069486069698467803\",\"user_ratings_total\":3,\"utc_offset\":-300,\"vicinity\":\"Pasaje Y, Quito\",\"location\":{\"lat\":-0.1096043,\"lng\":-78.5023389},\"expected_time\":34,\"schedule\":{\"start\":\"14:18\",\"end\":\"14:52\"}},{\"type\":\"route\",\"duration\":18.3,\"points\":\"vdSpkc~M[uBGwAHQPMRE`@AfAAxAEZMnAu@bBgA`@UZCJfBR|Ad@tAb@p@f@r@xBnCjBkArAaAv@fAh@r@~@~@z@^hATb@HTsA\",\"schedule\":{\"start\":\"14:52\",\"end\":\"15:10\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"Quito 170134, Ecuador\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/park-71.png\",\"name\":\"El Condado Park\",\"place_id\":\"ChIJ2ZpRu6OF1ZER_P2JB2RPAjY\",\"plus_code\":{\"compound_code\":\"VFWX+H7 Quito, Ecuador\",\"global_code\":\"67F3VFWX+H7\"},\"rating\":4.5,\"url\":\"https://maps.google.com/?cid=3891760319043337724\",\"user_ratings_total\":24,\"utc_offset\":-300,\"vicinity\":\"Quito\",\"location\":{\"lat\":-0.1035403,\"lng\":-78.5017956},\"expected_time\":90,\"schedule\":{\"start\":\"15:10\",\"end\":\"16:40\"}},{\"type\":\"route\",\"duration\":15.033333333333333,\"points\":\"vdSpkc~M[uBGwAHQPMRE`@AfAAxAEZMnAu@bBgA`@UGqB[sH|@S~Dg@tE_AVQjA_A`Ao@^Oj@K\",\"schedule\":{\"start\":\"16:40\",\"end\":\"16:55\"}},{\"type\":\"poi\",\"business_status\":\"OPERATIONAL\",\"formatted_address\":\"Francisco de Rumiurco País, Quito 170103, Ecuador\",\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/park-71.png\",\"name\":\"Infantil Park\",\"place_id\":\"ChIJnx0HxJ-F1ZERBQl6D0XfQp4\",\"plus_code\":{\"compound_code\":\"VGR3+CG Quito, Ecuador\",\"global_code\":\"67F3VGR3+CG\"},\"rating\":4,\"url\":\"https://maps.google.com/?cid=11403922694160910597\",\"user_ratings_total\":3,\"utc_offset\":-300,\"vicinity\":\"Francisco de Rumiurco País, Quito\",\"location\":{\"lat\":-0.1089808,\"lng\":-78.49613959999999},\"expected_time\":90,\"schedule\":{\"start\":\"16:55\",\"end\":\"18:54\"}}],\"restaurants\":[{\"business_status\":\"OPERATIONAL\",\"geometry\":{\"viewport\":{\"northeast\":{\"lat\":-0.1177497701072778,\"lng\":-78.49761352010728},\"southwest\":{\"lat\":-0.1204494298927222,\"lng\":-78.50031317989273}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/restaurant-71.png\",\"name\":\"Racing Restaurant\",\"opening_hours\":{\"open_now\":false},\"place_id\":\"ChIJc1GrNPSF1ZERoNmC0J6qVXw\",\"plus_code\":{\"compound_code\":\"VGJ2+9F Quito\",\"global_code\":\"67F3VGJ2+9F\"},\"rating\":0,\"reference\":\"ChIJc1GrNPSF1ZERoNmC0J6qVXw\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":0,\"vicinity\":\"Sabanilla, Quito\",\"location\":{\"lat\":-0.119086,\"lng\":-78.498862},\"schedule\":{\"start\":\"13:00\",\"end\":\"14:00\"}},{\"business_status\":\"OPERATIONAL\",\"geometry\":{\"viewport\":{\"northeast\":{\"lat\":-0.1161660701072778,\"lng\":-78.50298357010726},\"southwest\":{\"lat\":-0.1188657298927222,\"lng\":-78.50568322989271}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/restaurant-71.png\",\"name\":\"MOLI MAR\",\"place_id\":\"ChIJGaSMne6F1ZERr7JzqeY6y0I\",\"plus_code\":{\"compound_code\":\"VFJW+X7 Quito\",\"global_code\":\"67F3VFJW+X7\"},\"rating\":0,\"reference\":\"ChIJGaSMne6F1ZERr7JzqeY6y0I\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":0,\"vicinity\":\"Rio Bombonaqui, Quito\",\"location\":{\"lat\":-0.1175183,\"lng\":-78.50433819999999},\"schedule\":{\"start\":\"13:00\",\"end\":\"14:00\"}},{\"business_status\":\"OPERATIONAL\",\"geometry\":{\"viewport\":{\"northeast\":{\"lat\":-0.1161922701072778,\"lng\":-78.49584147010728},\"southwest\":{\"lat\":-0.1188919298927222,\"lng\":-78.49854112989271}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/restaurant-71.png\",\"name\":\"Santiago\",\"place_id\":\"ChIJV2x6RxSF1ZERHxnEaFR0kNM\",\"plus_code\":{\"compound_code\":\"VGJ3+X4 Quito\",\"global_code\":\"67F3VGJ3+X4\"},\"rating\":0,\"reference\":\"ChIJV2x6RxSF1ZERHxnEaFR0kNM\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":0,\"vicinity\":\"Gral. José María Guerrero 1, Quito\",\"location\":{\"lat\":-0.1175367,\"lng\":-78.4971383},\"schedule\":{\"start\":\"13:00\",\"end\":\"14:00\"}},{\"business_status\":\"OPERATIONAL\",\"geometry\":{\"viewport\":{\"northeast\":{\"lat\":-0.1166242201072778,\"lng\":-78.49979722010727},\"southwest\":{\"lat\":-0.1193238798927222,\"lng\":-78.50249687989272}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/restaurant-71.png\",\"name\":\"Almuerzos\",\"place_id\":\"ChIJMQpVXvGF1ZERPolE39q8J4U\",\"plus_code\":{\"compound_code\":\"VFJX+RF Quito\",\"global_code\":\"67F3VFJX+RF\"},\"rating\":5,\"reference\":\"ChIJMQpVXvGF1ZERPolE39q8J4U\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":1,\"vicinity\":\"Huachi 45, Quito\",\"location\":{\"lat\":-0.1179812,\"lng\":-78.501325},\"schedule\":{\"start\":\"13:00\",\"end\":\"14:00\"}},{\"business_status\":\"OPERATIONAL\",\"geometry\":{\"viewport\":{\"northeast\":{\"lat\":-0.1175257701072778,\"lng\":-78.49779097010729},\"southwest\":{\"lat\":-0.1202254298927222,\"lng\":-78.50049062989272}}},\"icon\":\"https://maps.gstatic.com/mapfiles/place_api/icons/v1/png_71/restaurant-71.png\",\"name\":\"EcuaCairo\",\"opening_hours\":{\"open_now\":false},\"photos\":[{\"height\":720,\"html_attributions\":[\"<a href=\\\"https://maps.google.com/maps/contrib/112035753837613689842\\\">A Google User</a>\"],\"photo_reference\":\"Aap_uEBC20LMsUT-3RKoiHLtSsgwZ1RmlfnIqbsX52EkuhgKN9LO8ANsel-GdE8VZxRQmz3eRqt3KOaPwwFa9xgLaex4rqAbXatylJlctlQI9JfrqLAN9ltroOntvGpzBhRZbMZ2dwYOQpqc17pVfjaHAq84D6Xo7dz8j5wawP4BIH0i08WV\",\"width\":1280}],\"place_id\":\"ChIJEVnUm6OF1ZER5ExrLAL9zYM\",\"plus_code\":{\"compound_code\":\"VGJ2+C8 Quito\",\"global_code\":\"67F3VGJ2+C8\"},\"rating\":5,\"reference\":\"ChIJEVnUm6OF1ZER5ExrLAL9zYM\",\"scope\":\"GOOGLE\",\"types\":[\"restaurant\",\"food\",\"point_of_interest\",\"establishment\"],\"user_ratings_total\":2,\"vicinity\":\"Machala y, José H. Figueroa, Quito\",\"location\":{\"lat\":-0.1189269,\"lng\":-78.499128},\"schedule\":{\"start\":\"13:00\",\"end\":\"14:00\"}}]}]";
        //yield return request.SendWebRequest();

        if (request.error != null)
        {
            Debug.Log("Error: " + request.error);
            PlayerPrefs.SetString("errorDatosServicio", "Could not connect to the service");
            SceneManager.LoadScene("SceneForm");
        }
        else
        {
            Debug.Log("All OK");
            Debug.Log("Status Code: " + request.responseCode);
            //var respuesta = JsonUtility.FromJson<>(request.downloadHandler.text);

            schedule = JsonConvert.DeserializeObject<Schedule[]>(respuesta);

            days = new List<PointOfInterest>[schedule.Length];

            for (int i = 0; i < schedule.Length; i++)
            {
                days[i] = new List<PointOfInterest>();

                for (int j = 0; j < schedule[i].tour.Length; j++)
                {
                    poi = JsonConvert.DeserializeObject<PointOfInterest>(schedule[i].tour[j].ToString());
                    if (poi.type == "poi")
                    {
                        if(poi.opening_hours != null)
                            poi.open_hours = JsonConvert.DeserializeObject<OpenHour>(poi.opening_hours.ToString());
                        days[i].Add(poi);
                    }
                }
            }

            if(days != null && days.Length != 0)
            {
                variables = GameObject.Find("Controller").GetComponent<Variables>();
                variables.days = days;
                SceneManager.LoadScene("Scene1");
            }
            else
            {
                PlayerPrefs.SetString("errorDatosServicio", "The requested information could not be generated, try again");
                SceneManager.LoadScene("SceneForm");
            }
        }
    }
}